# Completed data ----------------------------------------------------------
#### Demographics ####
dems.ids <- dems.df %>% filter(dems.full) %>% pull(id)
#### SDS ####
sds.ids <- ma.df %>%
filter(sds.full) %>% pull(id)
#### DDDI ####
dd.ids <- dd.df %>% filter(dd.full) %>% pull(id)
#### Anger ####
state.ids <- state.df %>% filter(state.full) %>% pull(id)
trait.ids <- trait.df %>% filter(trait.full) %>% pull(id)
#### AUDIT ####
audit.ids <- audit.df %>% filter(audit.full) %>% pull(id)
#### DUID ####
##### Instances #####
duid.inst.ids <- duid.inst.df %>%
filter(duid.inst.full) %>% pull(id)
##### Attitudes #####
duid.att.ids <- duid.att.df %>%
filter(duid.att.full) %>% pull(id)
##### Strategies #####
duid.strat.ids <- duid.strat.df %>%
filter(duid.strat.full) %>% pull(id)
#### DUI ####
##### Attitudes #####
dui.att.ids <- dui.att.df %>%
filter(dui.att.full) %>% pull(id)
##### Strategies #####
dui.strat.ids <- dui.strat.df %>%
filter(dui.strat.full) %>% pull(id)
# Sample sizes ------------------------------------------------------------
#### Sample of Meth users ####
ma.ids <- dems.df %>%
filter(
ma.ingest
,dems.full
,id %in% sds.ids
,id %in% dd.ids
,id %in% trait.ids
,id %in% state.ids
,id %in% audit.ids
# ,id %in% duid.inst.ids
,id %in% dui.att.ids
,id %in% dui.strat.ids
,id %in% duid.att.ids
,id %in% duid.strat.ids
) %>% pull(id)
length(ma.ids)
sds.df
# Full dataframe ----------------------------------------------------------
dems.df %>%
left_join(ma.df)
glimpse(trait.df)
dems.df
# Full dataframe ----------------------------------------------------------
dems.df %>%
filter(id %in% c(ma.ids, n.mda.ids))
# Full dataframe ----------------------------------------------------------
dems.df %>%
filter(id %in% c(ma.ids, n.ma.ids))
# Sample sizes ------------------------------------------------------------
#### Sample of Meth users ####
ma.ids <- dems.df %>%
filter(
ma.ingest
,dems.full
,id %in% sds.ids
,id %in% dd.ids
,id %in% trait.ids
,id %in% state.ids
,id %in% audit.ids
# ,id %in% duid.inst.ids
,id %in% dui.att.ids
,id %in% dui.strat.ids
,id %in% duid.att.ids
,id %in% duid.strat.ids
) %>% pull(id)
#### Sample of non-drug users
n.ma.ids <- dems.df %>%
filter(
!ma.ingest
,dems.full
,id %in% dd.ids
,id %in% trait.ids
,id %in% audit.ids
,id %in% dui.att.ids
,id %in% dui.strat.ids
,id %in% duid.att.ids
) %>% pull(id)
# Full dataframe ----------------------------------------------------------
dems.df %>%
filter(id %in% c(ma.ids, n.ma.ids))
length(ma.ids) + length(n.ma.ids)
glimpse(ma.df)
ma.df %>% filder(id %in% ma.ids)
ma.df %>% filter(id %in% ma.ids)
ma.df %>% filter(id %in% ma.ids) %>% count(ma.most.common)
ma.df %>% filter(id %in% ma.ids) %>% glimpse()
ma.df %>% filter(id %in% ma.ids) %>% glimpse()
left_join(select(ma.df, id, ma.use.peak, ma.12.months, ma.recent.use, ma.use.age, ma.use.ways, sds.total, ma.type,
ma.want.to.change))
# Full dataframe ----------------------------------------------------------
dat <- dems.df %>%
filter(id %in% c(ma.ids, n.ma.ids)) %>%
left_join(select(ma.df, id, ma.use.peak, ma.12.months, ma.recent.use, ma.use.age, ma.use.ways, sds.total, ma.type,
ma.want.to.change))
dems.df %>%
filter(id %in% c(ma.ids, n.ma.ids)) %>%
left_join(select(ma.df, id, ma.use.peak, ma.12.months, ma.recent.use, ma.use.age, ma.use.ways, sds.total, ma.type,
ma.want.to.change))
glimpse(dd.df)
names(dems.df)
glimpse(dd.df)
dems.df %>%
filter(id %in% c(ma.ids, n.ma.ids)) %>%
left_join(select(ma.df, id, ma.use.peak, ma.12.months, ma.recent.use, ma.use.age, ma.use.ways, sds.total, ma.type,
ma.want.to.change)) %>%
left_join(select(dd.df, id, dd.ne.total, dd.ad.total, dd.rd.total, dd.total))
dems.df %>%
filter(id %in% c(ma.ids, n.ma.ids)) %>%
left_join(select(ma.df, id, ma.use.peak, ma.12.months, ma.recent.use, ma.use.age, ma.use.ways, sds.total, ma.type,
ma.want.to.change)) %>%
left_join(select(dd.df, id, dd.ne.total, dd.ad.total, dd.rd.total, dd.total, dd.full)) %>% count(dd.full)
glimpse(trait.df)
dems.df %>%
filter(id %in% c(ma.ids, n.ma.ids)) %>%
left_join(select(ma.df, id, ma.use.peak, ma.12.months, ma.recent.use, ma.use.age, ma.use.ways, sds.total, ma.type,
ma.want.to.change)) %>%
left_join(select(dd.df, id, dd.ne.total, dd.ad.total, dd.rd.total, dd.total)) %>%
left_join(select(trait.df, id, trait.total))
glimpse(state.df)
dems.df %>%
filter(id %in% c(ma.ids, n.ma.ids)) %>%
left_join(select(ma.df, id, ma.use.peak, ma.12.months, ma.recent.use, ma.use.age, ma.use.ways, sds.total, ma.type,
ma.want.to.change)) %>%
left_join(select(dd.df, id, dd.ne.total, dd.ad.total, dd.rd.total, dd.total)) %>%
left_join(select(trait.df, id, trait.total)) %>%
left_join(select(state.df, id, state.total))
glimpse(audit.df)
dems.df %>%
filter(id %in% c(ma.ids, n.ma.ids)) %>%
left_join(select(ma.df, id, ma.use.peak, ma.12.months, ma.recent.use, ma.use.age, ma.use.ways, sds.total, ma.type,
ma.want.to.change)) %>%
left_join(select(dd.df, id, dd.ne.total, dd.ad.total, dd.rd.total, dd.total)) %>%
left_join(select(trait.df, id, trait.total)) %>%
left_join(select(state.df, id, state.total)) %>%
left_join(select(audit.df, id, audit.total, audit.risky))
#### Sample of non-drug users
n.ma.ids <- dems.df %>%
filter(
!ma.ingest
,dems.full
,id %in% dd.ids
,id %in% trait.ids
,id %in% audit.ids
,id %in% dui.att.ids
,id %in% dui.strat.ids
,id %in% duid.att.ids
,id %in% duid.strat.ids
) %>% pull(id)
length(n.ma.ids)
duid.strat.ids
duid.strat.df
duid.strat.df %>% count(ma.ingest)
glimpse(dui.att.df)
dems.df %>%
filter(id %in% c(ma.ids, n.ma.ids)) %>%
left_join(select(ma.df, id, ma.use.peak, ma.12.months, ma.recent.use, ma.use.age, ma.use.ways, sds.total, ma.type,
ma.want.to.change)) %>%
# DDDI
left_join(select(dd.df, id, dd.ne.total, dd.ad.total, dd.rd.total, dd.total)) %>%
# Anger
left_join(select(trait.df, id, trait.total)) %>%
left_join(select(state.df, id, state.total)) %>%
# Alcohol Use (AUDIT)
left_join(select(audit.df, id, audit.total, audit.risky)) %>%
# DUI
left_join(select(dui.att.df, id, dui.att.risk, dui.att.sanction, dui.att.peer, dui.att.mean))
dems.df %>%
filter(id %in% c(ma.ids, n.ma.ids)) %>%
left_join(select(ma.df, id, ma.use.peak, ma.12.months, ma.recent.use, ma.use.age, ma.use.ways, sds.total, ma.type,
ma.want.to.change)) %>%
# DDDI
left_join(select(dd.df, id, dd.ne.total, dd.ad.total, dd.rd.total, dd.total)) %>%
# Anger
left_join(select(trait.df, id, trait.total)) %>%
left_join(select(state.df, id, state.total)) %>%
# Alcohol Use (AUDIT)
left_join(select(audit.df, id, audit.total, audit.risky))
#### Sample of non-drug users
n.ma.ids <- dems.df %>%
filter(
!ma.ingest
,dems.full
,id %in% dd.ids
,id %in% trait.ids
,id %in% audit.ids
,id %in% dui.att.ids
,id %in% dui.strat.ids
,id %in% duid.att.ids
) %>% pull(id)
dems.df %>%
filter(id %in% c(ma.ids, n.ma.ids)) %>%
left_join(select(ma.df, id, ma.use.peak, ma.12.months, ma.recent.use, ma.use.age, ma.use.ways, sds.total, ma.type,
ma.want.to.change)) %>%
# DDDI
left_join(select(dd.df, id, dd.ne.total, dd.ad.total, dd.rd.total, dd.total)) %>%
# Anger
left_join(select(trait.df, id, trait.total)) %>%
left_join(select(state.df, id, state.total)) %>%
# Alcohol Use (AUDIT)
left_join(select(audit.df, id, audit.total, audit.risky)) %>%
# DUI
left_join(select(dui.att.df, id, dui.att.risk, dui.att.sanction, dui.att.peer, dui.att.mean))
dui.strat.df
glimpse(dui.strat.df)
glimpse(dui.strat.dich.df)
duid.att.df
glimpse(duid.att.df)
dems.df %>%
filter(id %in% c(ma.ids, n.ma.ids)) %>%
left_join(select(ma.df, id, ma.use.peak, ma.12.months, ma.recent.use, ma.use.age, ma.use.ways, sds.total, ma.type,
ma.want.to.change)) %>%
# DDDI
left_join(select(dd.df, id, dd.ne.total, dd.ad.total, dd.rd.total, dd.total)) %>%
# Anger
left_join(select(trait.df, id, trait.total)) %>%
left_join(select(state.df, id, state.total)) %>%
# Alcohol Use (AUDIT)
left_join(select(audit.df, id, audit.total, audit.risky)) %>%
# DUI
left_join(select(dui.att.df, id, dui.att.risk, dui.att.sanction, dui.att.peer, dui.att.mean)) %>%
# left_join(select(dui.strat.df, id, dui.strat.total))
# DUID
left_join(select(duid.att.df, id, duid.att.risk, duid.att.sanction, duid.att.peer, duid.att.mean))
glimpse(duid.strat.df)
k6.df
glimpse(k6.df)
#### K6 Psychological Distress ####
k6.ids <- k6.df %>%
filter(k6.full) %>%
pull(id)
length(k6.ids)
# Sample sizes ------------------------------------------------------------
#### Sample of Meth users ####
ma.ids <- dems.df %>%
filter(
ma.ingest
,dems.full
,id %in% sds.ids
,id %in% dd.ids
,id %in% trait.ids
,id %in% state.ids
,id %in% audit.ids
,id %in% k6.ids
,id %in% dui.att.ids
,id %in% dui.strat.ids
# ,id %in% duid.inst.ids
,id %in% duid.att.ids
,id %in% duid.strat.ids
) %>% pull(id)
length(ma.ids)
k6.df %>% filter(ma.ingest)
# Sample sizes ------------------------------------------------------------
#### Sample of Meth users ####
ma.ids.k6 <- dems.df %>%
filter(
ma.ingest
,dems.full
,id %in% sds.ids
,id %in% dd.ids
,id %in% trait.ids
,id %in% state.ids
,id %in% audit.ids
,id %in% k6.ids
,id %in% dui.att.ids
,id %in% dui.strat.ids
# ,id %in% duid.inst.ids
,id %in% duid.att.ids
,id %in% duid.strat.ids
) %>% pull(id)
# Sample sizes ------------------------------------------------------------
#### Sample of Meth users ####
ma.ids <- dems.df %>%
filter(
ma.ingest
,dems.full
,id %in% sds.ids
,id %in% dd.ids
,id %in% trait.ids
,id %in% state.ids
,id %in% audit.ids
# ,id %in% k6.ids
,id %in% dui.att.ids
,id %in% dui.strat.ids
# ,id %in% duid.inst.ids
,id %in% duid.att.ids
,id %in% duid.strat.ids
) %>% pull(id)
ma.ids
ma.ids %>% as_tibble()
ma.ids %>% as_tibble() %>% filter(!value %in% ma.ids.k6)
k6.df %>% filter(id == 462)
k6.df %>% filter(id == 462) %>% view
length(n.ma.ids)
#### Sample of non-drug users
n.ma.ids <- dems.df %>%
filter(
!ma.ingest
,dems.full
,id %in% dd.ids
,id %in% trait.ids
,id %in% audit.ids
,id %in% k6.ids
,id %in% dui.att.ids
,id %in% dui.strat.ids
,id %in% duid.att.ids
) %>% pull(id)
length(n.ma.ids)
# Sample ------------------------------------------------------------------
#### Sample of Meth users ####
ma.ids <- dems.df %>%
filter(
ma.ingest
,dems.full
,id %in% sds.ids
,id %in% dd.ids
,id %in% trait.ids
,id %in% state.ids
,id %in% audit.ids
,id %in% k6.ids
,id %in% dui.att.ids
,id %in% dui.strat.ids
# ,id %in% duid.inst.ids
,id %in% duid.att.ids
,id %in% duid.strat.ids
) %>% pull(id)
#### Sample of non-drug users
n.ma.ids <- dems.df %>%
filter(
!ma.ingest
,dems.full
,id %in% dd.ids
,id %in% trait.ids
,id %in% audit.ids
,id %in% k6.ids
,id %in% dui.att.ids
,id %in% dui.strat.ids
,id %in% duid.att.ids
) %>% pull(id)
glimpse(k6.df)
k6.df %>% count(psychiatric.diagnosis)
k6.df %>% count(psychiatric.diagnosis) %>% print(n = Inf)
glimpse(k6.df)
dems.df %>%
filter(id %in% c(ma.ids, n.ma.ids)) %>%
left_join(select(ma.df, id, ma.use.peak, ma.12.months, ma.recent.use, ma.use.age, ma.use.ways, sds.total, ma.type,
ma.want.to.change)) %>%
# DDDI
left_join(select(dd.df, id, dd.ne.total, dd.ad.total, dd.rd.total, dd.total)) %>%
# Anger
left_join(select(trait.df, id, trait.total)) %>%
left_join(select(state.df, id, state.total)) %>%
# Alcohol Use (AUDIT)
left_join(select(audit.df, id, audit.total, audit.risky)) %>%
# Psychological Distress
left_join(select(k6.df, id, k6.total, psychiatric.diagnosis)) %>%
# DUI
left_join(select(dui.att.df, id, dui.att.risk, dui.att.sanction, dui.att.peer, dui.att.mean)) %>%
# left_join(select(dui.strat.df, id, dui.strat.total))
# DUID
left_join(select(duid.att.df, id, duid.att.risk, duid.att.sanction, duid.att.peer, duid.att.mean))
# Full dataframe ----------------------------------------------------------
dat <- dems.df %>%
filter(id %in% c(ma.ids, n.ma.ids)) %>%
left_join(select(ma.df, id, ma.use.peak, ma.12.months, ma.recent.use, ma.use.age, ma.use.ways, sds.total, ma.type,
ma.want.to.change)) %>%
# DDDI
left_join(select(dd.df, id, dd.ne.total, dd.ad.total, dd.rd.total, dd.total)) %>%
# Anger
left_join(select(trait.df, id, trait.total)) %>%
left_join(select(state.df, id, state.total)) %>%
# Alcohol Use (AUDIT)
left_join(select(audit.df, id, audit.total, audit.risky)) %>%
# Psychological Distress
left_join(select(k6.df, id, k6.total, psychiatric.diagnosis)) %>%
# DUI
left_join(select(dui.att.df, id, dui.att.risk, dui.att.sanction, dui.att.peer, dui.att.mean)) %>%
# left_join(select(dui.strat.df, id, dui.strat.total))
# DUID
left_join(select(duid.att.df, id, duid.att.risk, duid.att.sanction, duid.att.peer, duid.att.mean))
save.objects()
pwd()
wd()
getwd()
root()
#### Save Objects ####
save.objects <- function(path = NULL) {
if(is.null(path)){
path <- "objects/all-objects.RData"
save.image(file = path)
} else{
path <- path
save.image(file = path)
}
message(crayon::green(str_glue("Environment saved at ", "{path}")))
}
save.objects()
message(crayon::green(str_glue("Environment saved at ", crayon::black("{path}"))))
save.objecT()
save.objects()
dat
glimpse(dat)
dat %>% count(ma.ingest)
# DUID Error plot
dat %>%
select(id, ma.ingest, starts_With(duid)) %>%
pivot_longer(cols = c(duid.att.risk, duid.att.sanction, duid.att.peer))
# DUID Error plot
dat %>%
select(id, ma.ingest, starts_with(duid)) %>%
pivot_longer(cols = c(duid.att.risk, duid.att.sanction, duid.att.peer))
# DUID Error plot
dat %>%
select(id, ma.ingest, starts_with("duid")) %>%
pivot_longer(cols = c(duid.att.risk, duid.att.sanction, duid.att.peer))
# DUID Error plot
dat %>%
select(id, ma.ingest, starts_with("duid")) %>%
pivot_longer(cols = c(duid.att.risk, duid.att.sanction, duid.att.peer)) +
ggplot(aes(x = name, y = value)) +
geom_bar(postition = "dodge")
# DUID Error plot
dat %>%
select(id, ma.ingest, starts_with("duid")) %>%
pivot_longer(cols = c(duid.att.risk, duid.att.sanction, duid.att.peer)) +
ggplot(aes(x = name, y = value)) +
geom_col(postition = "dodge")
# DUID Error plot
dat %>%
select(id, ma.ingest, starts_with("duid")) %>%
pivot_longer(cols = c(duid.att.risk, duid.att.sanction, duid.att.peer)) +
ggplot(aes(x = name, y = value)) +
geom_col()
dat %>%
select(id, ma.ingest, starts_with("duid")) %>%
pivot_longer(cols = c(duid.att.risk, duid.att.sanction, duid.att.peer))
# DUID Error plot
dat %>%
select(id, ma.ingest, starts_with("duid")) %>%
pivot_longer(cols = c(duid.att.risk, duid.att.sanction, duid.att.peer)) +
ggplot(aes(x = name, y = value))
# DUID Error plot
dat %>%
select(id, ma.ingest, starts_with("duid")) %>%
pivot_longer(cols = c(duid.att.risk, duid.att.sanction, duid.att.peer)) %>%
ggplot(aes(x = name, y = value)) +
geom_col(position = "dodge")
# DUID Error plot
dat %>%
select(id, ma.ingest, starts_with("duid")) %>%
pivot_longer(cols = c(duid.att.risk, duid.att.sanction, duid.att.peer)) %>%
ggplot(aes(x = name, y = value, fill = ma.ingest)) +
geom_col(position = "dodge")
glimpse(dat)
# Mediation analysis
lm(dd.total ~ ma.ingest, data = dat)
# Mediation analysis
x <- lm(dd.total ~ ma.ingest, data = dat)
summary(x)
dd.total %>% filter(ma.ingest) %>% summarise(mean(dd.total))
dd.df %>% filter(ma.ingest) %>% summarise(mean(dd.total))
dd.df %>% filter(ma.ingest) %>% summarise(mean(dd.total, na.rm = T))
dd.df %>% filter(!ma.ingest) %>% summarise(mean(dd.total, na.rm = T))
packages <- c("janitor",
# "table1",
"gt",
"naniar",
"kableExtra",
# "GGally",
# "mctest",
# "stargazer",
"flextable",
# "xaringan",
"DT",
"patchwork",
"tidyverse",
"olsrr",
"broom",
"gtsummary",
"officer",
"shadowtext",
"rstatix", # For ANOVA test and quick summary stats
"ggpubr", # Publishable graphs
"gdtools" # For font name
,"lavaan" # path analysis (latent varable analysis)
)
librarian::shelf(packages)
if(!"packages" %in% ls()){
source("scripts/load-packages.R")
}
source("scripts/functions.R")
load("objects/all-objects.RData")
tbl.dems
# For ARSC Conference
#### Age and Gender Breakdown ####
tbl.dems <- dat.dems %>%
mutate(ma.ingest = if_else(ma.ingest, "MA User", "Non-Drug User"),
any.psychiatric.diagnosis = if_else(any.psychiatric.diagnosis, "Yes", "No")) %>%
select(ma.ingest, Age = age, education,  ever.used.alcohol = alcohol.ever, employment.status, license.status, psychiatric.diagnosis = any.psychiatric.diagnosis, residential.area = area.live, Sex = sex) %>%
prep.names() %>%
ft.summary(summ.by = "Ma Ingest", include.p = TRUE)
