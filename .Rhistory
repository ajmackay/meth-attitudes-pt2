dat %>%
group_by(ma.ingest) %>%
pivot_longer(cols = c(duid.att.sanction, duid.att.risk, duid.att.peer), names_to = 'att.group') %>%
mutate(att.group = case_when(
att.group == 'duid.att.sanction' ~ "Sanctions",
att.group == 'duid.att.risk' ~ "Risks",
att.group == 'duid.att.peer' ~ "Peer Attitudes"
),
group = if_else(ma.ingest, "People who use methamphetamine", "Non-Drug users")) %>%
ggplot(aes(x = att.group, y = value, fill = group)) +
geom_boxplot(position = 'dodge') +
labs(x = "DUID Attitude Factor",
y = "Average Score",
fill = "Group")
dat %>%
group_by(ma.ingest) %>%
pivot_longer(cols = c(duid.att.sanction, duid.att.risk, duid.att.peer), names_to = 'att.group') %>%
mutate(att.group = case_when(
att.group == 'duid.att.sanction' ~ "Sanctions",
att.group == 'duid.att.risk' ~ "Risks",
att.group == 'duid.att.peer' ~ "Peer Attitudes"
),
group = if_else(ma.ingest, "Methamphetamine users", "Non-Drug users")) %>%
ggplot(aes(x = att.group, y = value, fill = group)) +
geom_boxplot(position = 'dodge') +
labs(x = "DUID Attitude Factor",
y = "Average Score",
fill = "Group") +
scale_fill_brewer(palette = "OrRd")
dat %>%
group_by(ma.ingest) %>%
pivot_longer(cols = c(duid.att.sanction, duid.att.risk, duid.att.peer), names_to = 'att.group') %>%
mutate(att.group = case_when(
att.group == 'duid.att.sanction' ~ "Sanctions",
att.group == 'duid.att.risk' ~ "Risks",
att.group == 'duid.att.peer' ~ "Peer Attitudes"
),
group = if_else(ma.ingest, "Methamphetamine users", "Non-Drug users")) %>%
ggplot(aes(x = att.group, y = value, fill = group)) +
geom_boxplot(position = 'dodge') +
labs(x = "DUID Attitude Factor",
y = "Average Score",
fill = "Group") +
scale_fill_brewer(palette = "OrRd") +
theme_light()
dat %>%
group_by(ma.ingest) %>%
pivot_longer(cols = c(duid.att.sanction, duid.att.risk, duid.att.peer), names_to = 'att.group') %>%
mutate(att.group = case_when(
att.group == 'duid.att.sanction' ~ "Sanctions",
att.group == 'duid.att.risk' ~ "Risks",
att.group == 'duid.att.peer' ~ "Peer Attitudes"
),
group = if_else(ma.ingest, "Methamphetamine users", "Non-Drug users")) %>%
ggplot(aes(x = att.group, y = value, fill = group)) +
geom_boxplot(position = 'dodge') +
labs(x = "DUID Attitude Factor",
y = "Average Score",
fill = "Group") +
scale_fill_brewer(palette = "OrRd") +
theme_light() +
theme(panel.grid.major.x = element_blank())
dat %>%
group_by(ma.ingest) %>%
pivot_longer(cols = c(duid.att.sanction, duid.att.risk, duid.att.peer), names_to = 'att.group') %>%
mutate(att.group = case_when(
att.group == 'duid.att.sanction' ~ "Sanctions",
att.group == 'duid.att.risk' ~ "Risks",
att.group == 'duid.att.peer' ~ "Peer Attitudes"
),
group = if_else(ma.ingest, "Methamphetamine users", "Non-Drug users")) %>%
ggplot(aes(x = att.group, y = value, fill = group)) +
geom_boxplot(position = 'dodge', width = 0.5) +
labs(x = "DUID Attitude Factor",
y = "Average Score",
fill = "Group") +
scale_fill_brewer(palette = "OrRd") +
theme_light() +
theme(panel.grid.major.x = element_blank())
dat %>%
group_by(ma.ingest) %>%
pivot_longer(cols = c(duid.att.sanction, duid.att.risk, duid.att.peer), names_to = 'att.group') %>%
mutate(att.group = case_when(
att.group == 'duid.att.sanction' ~ "Sanctions",
att.group == 'duid.att.risk' ~ "Risks",
att.group == 'duid.att.peer' ~ "Peer Attitudes"
),
group = if_else(ma.ingest, "Methamphetamine users", "Non-Drug users")) %>%
ggplot(aes(x = att.group, y = value, fill = group)) +
geom_boxplot(position = 'dodge', width = 0.7) +
labs(x = "DUID Attitude Factor",
y = "Average Score",
fill = "Group") +
scale_fill_brewer(palette = "OrRd") +
theme_light() +
theme(panel.grid.major.x = element_blank())
p.att.score <- dat %>%
group_by(ma.ingest) %>%
pivot_longer(cols = c(duid.att.sanction, duid.att.risk, duid.att.peer), names_to = 'att.group') %>%
mutate(att.group = case_when(
att.group == 'duid.att.sanction' ~ "Sanctions",
att.group == 'duid.att.risk' ~ "Risks",
att.group == 'duid.att.peer' ~ "Peer Attitudes"
),
group = if_else(ma.ingest, "Methamphetamine users", "Non-Drug users")) %>%
ggplot(aes(x = att.group, y = value, fill = group)) +
geom_boxplot(position = 'dodge', width = 0.7) +
labs(x = "DUID Attitude Factor",
y = "Average Score",
fill = "Group") +
scale_fill_brewer(palette = "OrRd") +
theme_light() +
theme(panel.grid.major.x = element_blank())
ggsave(p.att.score, width = 900, height = 700, units = 'px', dpi = 95, filename = "output/attitude-boxplot.png")
t.summ
dat %>%
pivot_longer(cols = c(duid.att.risk, duid.att.sanction, duid.att.peer), names_to = "att.subscale") %>%
mutate(att.subscale = factor(att.subscale, levels = c("duid.att.risk", "duid.att.sanction", "duid.att.peer"))) %>%
ggboxplot(x = "att.subscale", y = "value", width = 0.5, fill = "ma.ingest") +
stat_pvalue_manual(
stat.test, x = "att.subscale", label = "p.adj",
y.position = c(8, 10, 9)
)
stat.test <- dat.long %>%
group_by(att.subscale) %>%
t_test(value ~ ma.ingest) %>%
adjust_pvalue() %>%
add_significance("p.adj") %>%
mutate(p.adj = scales::pvalue(p.adj))
ggboxplot(dat.long, x = "att.subscale", y = "value", width = 0.5, fill = "ma.ingest") +
stat_pvalue_manual(stat.test, x = "att.subscale", y.position = 8, label = "p.adj")
dat %>%
pivot_longer(cols = c(duid.att.risk, duid.att.sanction, duid.att.peer), names_to = "att.subscale") %>%
mutate(att.subscale = factor(att.subscale, levels = c("duid.att.risk", "duid.att.sanction", "duid.att.peer"))) %>%
ggboxplot(x = "att.subscale", y = "value", width = 0.5, fill = "ma.ingest") +
stat_pvalue_manual(
stat.test, x = "att.subscale", label = "p.adj",
y.position = c(8, 10, 9)
)
stat.test <- dat.long %>%
group_by(att.subscale) %>%
t_test(value ~ ma.ingest) %>%
adjust_pvalue() %>%
add_significance("p.adj") %>%
mutate(p.adj = scales::pvalue(p.adj))
#### Attitudes boxplot ####
dat.long <- dat %>%
pivot_longer(cols = c(duid.att.risk, duid.att.sanction, duid.att.peer), names_to = "att.subscale") %>%
mutate(att.subscale = factor(att.subscale, levels = c("duid.att.risk", "duid.att.sanction", "duid.att.peer")))
stat.test <- dat.long %>%
group_by(att.subscale) %>%
t_test(value ~ ma.ingest) %>%
adjust_pvalue() %>%
add_significance("p.adj") %>%
mutate(p.adj = scales::pvalue(p.adj))
ggboxplot(dat.long, x = "att.subscale", y = "value", width = 0.5, fill = "ma.ingest") +
stat_pvalue_manual(stat.test, x = "att.subscale", y.position = 8, label = "p.adj")
dat %>%
pivot_longer(cols = c(duid.att.risk, duid.att.sanction, duid.att.peer), names_to = "att.subscale") %>%
mutate(att.subscale = factor(att.subscale, levels = c("duid.att.risk", "duid.att.sanction", "duid.att.peer"))) %>%
ggboxplot(x = "att.subscale", y = "value", width = 0.5, fill = "ma.ingest") +
stat_pvalue_manual(
stat.test, x = "att.subscale", label = "p.adj",
y.position = c(8, 10, 9)
)
ggboxplot(dat.long, x = "att.subscale", y = "value", width = 0.5, fill = "ma.ingest") +
stat_pvalue_manual(stat.test, x = "att.subscale", y.position = 8, label = "p.adj")
dat %>%
pivot_longer(cols = c(duid.att.risk, duid.att.sanction, duid.att.peer), names_to = "att.subscale") %>%
mutate(att.subscale = factor(att.subscale, levels = c("duid.att.risk", "duid.att.sanction", "duid.att.peer"))) %>%
ggboxplot(x = "att.subscale", y = "value", width = 0.5, fill = "ma.ingest") +
stat_pvalue_manual(
stat.test, x = "att.subscale", label = "p.adj",
y.position = c(8, 10, 9)
)
dat %>%
mutate(dd.subscale = factor(dd.subscale, levels = c("dd.ad.total", "dd.ne.total", "dd.rd.total"))) %>%
ggboxplot(x = "dd.subscale", y = "value", width = 0.5, color = "ma.ingest")
dat %>%
mutate(dd.subscale = factor(dd.subscale, levels = c("dd.ad.total", "dd.ne.total", "dd.rd.total"))) %>%
ggboxplot(x = "dd.subscale", y = "value", width = 0.5, color = "ma.ingest")
ggboxplot(dat.long, x = "att.subscale", y = "value", width = 0.5, fill = "ma.ingest") +
stat_pvalue_manual(stat.test, x = "att.subscale", y.position = 8, label = "p.adj")
ggboxplot(dat.long, x = "att.subscale", y = "value", width = 0.5, fill = "ma.ingest") +
stat_pvalue_manual(stat.test, x = "att.subscale", y.position = 7, label = "p.adj")
ggboxplot(dat.long, x = "att.subscale", y = "value", width = 0.5, fill = "ma.ingest") +
stat_pvalue_manual(stat.test, x = "att.subscale", y.position = 7.5, label = "p.adj")
ggboxplot(dat.long, x = "att.subscale", y = "value", width = 0.5, fill = "ma.ingest") +
stat_pvalue_manual(stat.test, x = "att.subscale", y.position = 7.5, label = "p.adj") +
scale_fill_brewer(palette = "OrRd")
dat.long
#### Attitudes boxplot ####
dat.long <- dat %>%
pivot_longer(cols = c(duid.att.risk, duid.att.sanction, duid.att.peer), names_to = "att.subscale") %>%
mutate(att.subscale = factor(att.subscale, levels = c("duid.att.risk", "duid.att.sanction", "duid.att.peer")),
att.subscale = case_when(
att.subscale == "duid.att.risk" ~ "Risks",
att.subscale == "duid.att.sanction" ~ "Sanctions",
att.subscale == "duid.att.peer" ~ "Peer Attitudes"
))
ggboxplot(dat.long, x = "att.subscale", y = "value", width = 0.5, fill = "ma.ingest") +
stat_pvalue_manual(stat.test, x = "att.subscale", y.position = 7.5, label = "p.adj") +
scale_fill_brewer(palette = "OrRd")
#### Attitudes boxplot ####
dat.long <- dat %>%
pivot_longer(cols = c(duid.att.risk, duid.att.sanction, duid.att.peer), names_to = "att.subscale") %>%
mutate(
# att.subscale = factor(att.subscale, levels = c("duid.att.risk", "duid.att.sanction", "duid.att.peer")),
att.subscale = case_when(
att.subscale == "duid.att.risk" ~ "Risks",
att.subscale == "duid.att.sanction" ~ "Sanctions",
att.subscale == "duid.att.peer" ~ "Peer Attitudes"
))
stat.test <- dat.long %>%
group_by(att.subscale) %>%
t_test(value ~ ma.ingest) %>%
adjust_pvalue() %>%
add_significance("p.adj") %>%
mutate(p.adj = scales::pvalue(p.adj))
ggboxplot(dat.long, x = "att.subscale", y = "value", width = 0.5, fill = "ma.ingest") +
stat_pvalue_manual(stat.test, x = "att.subscale", y.position = 7.5, label = "p.adj") +
scale_fill_brewer(palette = "OrRd")
#### Attitudes boxplot ####
dat.long <- dat %>%
pivot_longer(cols = c(duid.att.risk, duid.att.sanction, duid.att.peer), names_to = "att.subscale") %>%
mutate(
# att.subscale = factor(att.subscale, levels = c("duid.att.risk", "duid.att.sanction", "duid.att.peer")),
att.subscale = case_when(
att.subscale == "duid.att.risk" ~ "Risks",
att.subscale == "duid.att.sanction" ~ "Sanctions",
att.subscale == "duid.att.peer" ~ "Peer Attitudes"
),
group = if_else(ma.ingest, "Methamphetamine Users", "Non-Drug Users"))
stat.test <- dat.long %>%
group_by(att.subscale) %>%
t_test(value ~ group) %>%
adjust_pvalue() %>%
add_significance("p.adj") %>%
mutate(p.adj = scales::pvalue(p.adj))
stat.test
ggboxplot(dat.long, x = "att.subscale", y = "value", width = 0.5, fill = "group") +
stat_pvalue_manual(stat.test, x = "att.subscale", y.position = 7.5, label = "p.adj") +
scale_fill_brewer(palette = "OrRd")
ggboxplot(dat.long, x = "att.subscale", y = "value", width = 0.5, fill = "group") +
stat_pvalue_manual(stat.test, x = "att.subscale", y.position = 7.5, label = "p.adj") +
labs(fill = element_blank())
ggboxplot(dat.long, x = "att.subscale", y = "value", width = 0.5, fill = "group") +
stat_pvalue_manual(stat.test, x = "att.subscale", y.position = 7.5, label = "p.adj") +
labs(fill = element_blank(),
x = "Attitude Factor",
y = "Average Score") +
scale_fill_brewer(palette = "OrRd")
ggboxplot(dat.long, x = "att.subscale", y = "value", width = 0.5, fill = "group") +
stat_pvalue_manual(stat.test, x = "att.subscale", y.position = 7.5, label = "p.adj") +
labs(fill = element_blank(),
x = "Attitude Factor",
y = "Score") +
scale_fill_brewer(palette = "OrRd")
ggboxplot(dat.long, x = "att.subscale", y = "value", width = 0.5, fill = "group") +
stat_pvalue_manual(stat.test, x = "att.subscale", y.position = 7.5, label = "p.adj") +
labs(fill = element_blank(),
x = "Attitude Factor",
y = "Score") +
scale_fill_brewer(palette = "OrRd") +
scale_y_continuous(breaks = seq(2, 7, 1))
ggboxplot(dat.long, x = "att.subscale", y = "value", width = 0.5, fill = "group") +
stat_pvalue_manual(stat.test, x = "att.subscale", y.position = 7.5, label = "p.adj") +
labs(fill = element_blank(),
x = "Attitude Factor",
y = "Score") +
scale_fill_brewer(palette = "OrRd") +
scale_y_continuous(breaks = seq(2, 7, 1)) +
theme(axis.title = element_text(face = 'bold'))
p.att.score <- ggboxplot(dat.long, x = "att.subscale", y = "value", width = 0.5, fill = "group") +
stat_pvalue_manual(stat.test, x = "att.subscale", y.position = 7.5, label = "p.adj") +
labs(fill = element_blank(),
x = "Attitude Factor",
y = "Score") +
scale_fill_brewer(palette = "OrRd") +
scale_y_continuous(breaks = seq(2, 7, 1)) +
theme(axis.title = element_text(face = 'bold'))
ggsave(p.att.score, width = 900, height = 700, units = 'px', dpi = 95, filename = "output/attitude-boxplot.png")
t.summ
dat.long %>% t_test(dd.total ~ group)
dat.long %>% t_test(dd.total ~ group) %>% adjust_pvalue()
dat.long %>% t_test(dd.total ~ group) %>% adjust_pvalue() %>% add_significance("p.adj")
dat.long %>% t_test(dd.total ~ group) %>% adjust_pvalue() %>% add_significance("p.adj") %>% mutate(p.adj = scales::pvalue(padj))
dat.long %>% t_test(dd.total ~ group) %>% adjust_pvalue() %>% add_significance("p.adj") %>% mutate(p.adj = scales::pvalue(p.adj))
dat.long %>% t_test(dd.total ~ group) %>% adjust_pvalue() %>% add_significance("p.adj") %>% mutate(p.adj = scales::pvalue(p.adj)) %>% view
dat %>% t_test(dd.total ~ ma.ingest) %>% adjust_pvalue() %>% add_significance("p.adj") %>% mutate(p.adj = scales::pvalue(p.adj)) %>% view
if(!"packages" %in% ls()) source("scripts/load-packages.R")
source("scripts/functions.R")
load("objects/all-objects.RData")
#### Sample Characteristics ####
##### Age and Gender Breakdown #####
tbl.dems <- dat.dems %>%
mutate(ma.ingest = if_else(ma.ingest, "MA User", "Non-Drug User"),
any.psychiatric.diagnosis = if_else(any.psychiatric.diagnosis, "Yes", "No")) %>%
select(ma.ingest, Age = age, Sex = sex, education,  ever.used.alcohol = alcohol.ever, employment.status, license.status, psychiatric.diagnosis = any.psychiatric.diagnosis, residential.area = area.live) %>%
prep.names() %>%
flex.summary(summ.by = "Ma Ingest", include.p = TRUE)
install.packages("devtools")
devtools::install_github('AzTools', username = 'ajmackay')
devtools::install_github('https://github.com/ajmackay/AzTools.git')
installr::check.for.updates.R()
install.packages('vctrs')
devtools::install_github('https://github.com/ajmackay/AzTools.git')
if(!"packages" %in% ls()) source("scripts/load-packages.R")
source("scripts/functions.R")
load("objects/all-objects.RData")
#### Sample Characteristics ####
##### Age and Gender Breakdown #####
tbl.dems <- dat.dems %>%
mutate(ma.ingest = if_else(ma.ingest, "MA User", "Non-Drug User"),
any.psychiatric.diagnosis = if_else(any.psychiatric.diagnosis, "Yes", "No")) %>%
select(ma.ingest, Age = age, Sex = sex, education,  ever.used.alcohol = alcohol.ever, employment.status, license.status, psychiatric.diagnosis = any.psychiatric.diagnosis, residential.area = area.live) %>%
prep.names() %>%
flex.summary(summ.by = "Ma Ingest", include.p = TRUE)
tbl.dems
dat
dat %>% group_by(ma.ingest) %>% summarise(min = min(age))
dat.dems %>% group_by(ma.ingest) %>% summarise(min = min(age))
dat.dems %>% group_by(ma.ingest) %>% summarise(min = min(age), max = max(age))
dat.dems %>% group_by(ma.ingest) %>% summarise(min = min(age), max = max(age), sd = sd(age))
#### Sample Characteristics ####
##### Age and Gender Breakdown #####
tbl.dems <- dat.dems %>%
mutate(ma.ingest = if_else(ma.ingest, "MA User", "Non-Drug User"),
any.psychiatric.diagnosis = if_else(any.psychiatric.diagnosis, "Yes", "No")) %>%
select(ma.ingest, Age = age, Sex = sex, education,  ever.used.alcohol = alcohol.ever, employment.status, license.status, psychiatric.diagnosis = any.psychiatric.diagnosis, residential.area = area.live) %>%
prep.names() %>%
flex.summary(summ.by = "Ma Ingest", include.p = TRUE, dp = 2)
tbl.dems
#### Sample Characteristics ####
##### Demographics #####
tbl.dems <- dat.dems %>%
mutate(ma.ingest = if_else(ma.ingest, "MA User", "Non-Drug User"),
any.psychiatric.diagnosis = if_else(any.psychiatric.diagnosis, "Yes", "No")) %>%
select(ma.ingest, Age = age, Sex = sex, education,  ever.used.alcohol = alcohol.ever, employment.status, license.status, psychiatric.diagnosis = any.psychiatric.diagnosis, residential.area = area.live) %>%
prep.names() %>%
flex.summary(summ.by = "Ma Ingest", include.p = !TRUE, dp = 2)
flex2xl(tbl.dems, "output/tables/demographics.xlsx")
tbl.dems
save.table)_
save.table()
source("scripts/functions.R")
if (FALSE) save_as_docx(tbl.dems, "output/tables/demographics.docx")
save_as_docx(tbl.dems, "output/tables/demographics.docx")
save_as_docx(tbl.dems, path = "output/tables/demographics.docx")
tbl.dems
#### Sample Characteristics ####
##### Demographics #####
tbl.dems <- dat.dems %>%
mutate(ma.ingest = if_else(ma.ingest, "MA User", "Non-Drug User"),
any.psychiatric.diagnosis = if_else(any.psychiatric.diagnosis, "Yes", "No")) %>%
select(ma.ingest, Age = age, Sex = sex, education,  ever.used.alcohol = alcohol.ever,
employment.status, license.status, psychiatric.diagnosis = any.psychiatric.diagnosis, residential.area = area.live,
audit.total) %>%
prep.names() %>%
flex.summary(summ.by = "Ma Ingest", include.p = !TRUE, dp = 2)
tbl.dems
#### Sample Characteristics ####
##### Demographics #####
tbl.dems <- dat.dems %>%
mutate(ma.ingest = if_else(ma.ingest, "MA User", "Non-Drug User"),
any.psychiatric.diagnosis = if_else(any.psychiatric.diagnosis, "Yes", "No")) %>%
select(ma.ingest, Age = age, Sex = sex, education,  ever.used.alcohol = alcohol.ever, audit.total,
employment.status, license.status, psychiatric.diagnosis = any.psychiatric.diagnosis, residential.area = area.live) %>%
prep.names() %>%
flex.summary(summ.by = "Ma Ingest", include.p = !TRUE, dp = 2)
tbl.dems
#### Sample Characteristics ####
##### Demographics #####
tbl.dems <- dat.dems %>%
mutate(ma.ingest = if_else(ma.ingest, "MA User", "Non-Drug User"),
any.psychiatric.diagnosis = if_else(any.psychiatric.diagnosis, "Yes", "No")) %>%
select(ma.ingest, Age = age, Sex = sex, education,  ever.used.alcohol = alcohol.ever, audit.total,
employment.status, license.status, psychiatric.diagnosis = any.psychiatric.diagnosis, residential.area = area.live) %>%
prep.names() %>%
flex.summary(summ.by = "Ma Ingest", include.p = !TRUE, dp = 2)
save_as_docx(tbl.dems, path = "output/tables/demographics.docx")
flex2xl(tbl.dems, "output/tables/demographics.xlsx")
flex2xl(tbl.dems, "output/tables/demographics.xlsx")
glimpse(dat.dems)
ma.df %>% glimpse()
#### Methamphetamine Use #####
ma.df %>%
filter(id %in% dat$id) %>%
select(ma.use.peak, ma.use.age, ma.use.ways, sds.total, ma.type) %>%
prep.names() %>%
flex.summary(dp = 2)
#### Methamphetamine Use #####
tbl.ma.use <- ma.df %>%
filter(id %in% dat$id) %>%
select(ma.use.peak, ma.use.age, ma.use.ways, sds.total, ma.type) %>%
prep.names() %>%
flex.summary(dp = 2)
save_as_docx(tbl.ma.use, path = "output/tables/ma-use.docx")
if (!"packages" %in% ls()) source("scripts/load-packages.R")
source("scripts/functions.R")
load("objects/all-objects.RData")
#### Sample Characteristics ####
##### Demographics #####
tbl.dems <- dat.dems %>%
mutate(ma.ingest = if_else(ma.ingest, "MA User", "Non-Drug User"),
any.psychiatric.diagnosis = if_else(any.psychiatric.diagnosis, "Yes", "No")) %>%
select(ma.ingest, Age = age, Sex = sex, education,  ever.used.alcohol = alcohol.ever, audit.total,
employment.status, license.status, psychiatric.diagnosis = any.psychiatric.diagnosis, residential.area = area.live) %>%
prep.names() %>%
flex.summary(summ.by = "Ma Ingest", include.p = !TRUE, dp = 2)
tbl.dems
8+20/53
(8+20)/53
(46+13)/72
(21+15)/53
(52+11)/72
glimpse(dat.dems)
audit.df
# AUDIT Scores
audit.df %>%
filter(id %in% dat$id)
# AUDIT Scores
audit.df %>%
filter(id %in% dat$id) %>%
group_by(ma.ingest) %>%
count(audit.risky) %>%
mutate(p = scales(n / sum(n), .1))
# AUDIT Scores
audit.df %>%
filter(id %in% dat$id) %>%
group_by(ma.ingest) %>%
count(audit.risky) %>%
mutate(p = scales::percent(n / sum(n), .1))
35+15
# AUDIT Scores
audit.df %>%
filter(id %in% dat$id) %>%
group_by(ma.ingest) %>%
count(audit.risky) %>%
mutate(p = scales::percent(n / sum(n), .2))
# AUDIT Scores
audit.df %>%
filter(id %in% dat$id) %>%
group_by(ma.ingest) %>%
count(audit.risky) %>%
mutate(p = scales::percent(n / sum(n), .01))
#### Methamphetamine Use #####
tbl.ma.use <- ma.df %>%
filter(id %in% dat$id) %>%
select(ma.use.peak, ma.use.age, ma.use.ways, sds.total, ma.type) %>%
prep.names() %>%
flex.summary(dp = 2)
tbl.ma.use
100-37.74
#### Free & Constrained Models ####
# Free Model
mgp.model <- "dd.total ~ duid.att.risk + duid.att.sanction + duid.att.peer"
mgp.free <- sem(mgp.model, data = dat, group = "ma.ingest")
summary(mgp.free)
summary(mgp.free)
# Constrained Model
mgp.constrained <- sem(mgp.model, dat, group = "ma.ingest", group.equal = c("intercepts", "regressions"))
summary(mgp.constrained)
# Comparing two models
anova(mgp.free, mgp.constrained) #%>% broom::tidy()
mgp.free
mgp.free %>% broom::tidy()
summary(mgp.free)
#### Comparing single constraints ####
# Risk
mgp.risk.model <- c("dd.total ~ c(b1, b1) * duid.att.risk + duid.att.sanction + duid.att.peer")
mgp.risk <- sem(mgp.risk.model, dat, group = "ma.ingest")
anova(mgp.free, mgp.risk)
# Sanction
mgp.sanction.model <-  c("dd.total ~ c(b1, b1) * duid.att.sanction + duid.att.risk + duid.att.peer")
mgp.sanction <- sem(mgp.sanction.model, dat, group = "ma.ingest")
anova(mgp.free, mgp.sanction)
# Peer
mgp.peer.model <- c("dd.total ~ c(b1, b1) * duid.att.peer + duid.att.risk + duid.att.sanction")
mgp.peer <- sem(mgp.peer.model, dat, group = "ma.ingest")
anova(mgp.free, mgp.peer)
#### Piecewise SEM  ####
# (basically does all the above stuff in one go lol)
model.psem <- piecewiseSEM::psem(lm(dd.total ~ duid.att.risk + duid.att.sanction + duid.att.peer, dat))
piecewiseSEM::multigroup(model.psem, group = "ma.ingest")
multigroup.model <- piecewiseSEM::multigroup(model.psem, group = "ma.ingest")
multigroup.model
summary(mgp.risk)
anova(mgp.free, mgp.risk)
anova(mgp.free, mgp.risk)
# Sanction
mgp.sanction.model <-  c("dd.total ~ c(b1, b1) * duid.att.sanction + duid.att.risk + duid.att.peer")
mgp.sanction <- sem(mgp.sanction.model, dat, group = "ma.ingest")
anova(mgp.free, mgp.sanction)
anova(mgp.free, mgp.risk)
# Sanction
mgp.sanction.model <-  c("dd.total ~ c(b1, b1) * duid.att.sanction + duid.att.risk + duid.att.peer")
mgp.sanction <- sem(mgp.sanction.model, dat, group = "ma.ingest")
anova(mgp.free, mgp.sanction)
# Peer
mgp.peer.model <- c("dd.total ~ c(b1, b1) * duid.att.peer + duid.att.risk + duid.att.sanction")
mgp.peer <- sem(mgp.peer.model, dat, group = "ma.ingest")
anova(mgp.free, mgp.peer)
anova(mgp.free, mgp.peer)
#### Piecewise SEM  ####
# (basically does all the above stuff in one go lol)
model.psem <- piecewiseSEM::psem(lm(dd.total ~ duid.att.risk + duid.att.sanction + duid.att.peer, dat))
piecewiseSEM::multigroup(model.psem, group = "ma.ingest")
multigroup.model <- piecewiseSEM::multigroup(model.psem, group = "ma.ingest")
multigroup.model
summary(mgp.free)
multigroup.model
